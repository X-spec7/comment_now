# Weby MVP Comment_Now プロジェクト概要

この Doc を更新するときは、Cursor/relatedAI にて必ず、対象の英語ファイルを更新してください。（Viceversa)

## プロジェクト目的

Comment Now は、**専門家によるコメント機能をメディアサイトに埋め込むサービス**です。SEO 向上とブランド権威獲得を主な目的とし、承認制のコメントシステムを通じて質の高いコンテンツを提供します。

## 仮説

- **SEO 向上**: 専門家のコメントがメディア記事の質を向上させ、検索エンジンでの評価向上に寄与する
- **ブランド権威獲得**: 専門家のコメント掲載により、メディアサイトの信頼性と権威性が向上する
- **専門家の露出**: 専門家にとっては新しい露出機会となり、相互利益を生む

## ペルソナ

### 事務局（管理者）

- メディア運営者(自社メディアの場合)
- 記事の質向上と SEO 効果を重視
- 承認制でコメントの品質をコントロールしたい

### 専門家 (Profile に在籍している)

- 各分野の専門知識を持つ人材
- 招待制で参加
- 自分の専門性をアピールしたい

### メディア運営者（先方）

- 既存のメディアサイト運営者
- 簡単な埋め込みでコメント機能を追加したい
- 技術的な負担を最小限に抑えたい

### 最初の課題解決試作

#### ◾️ 専門家が上記のニーズでコメントをしてくれるか

---

## 機能要件

### A. 基盤

#### 認証

- **事務局ログイン**: Email/Passwordless or OTP メール認証（もしくは DB 直認証）
- **専門家ログイン**: 同上、最初は招待ベースのみ（絞って招待）

#### メール送信

- **専門家招待メール**: Magic Link でログイン
  - 専門家さんの登録（DB に直接（Seed データ））
- **投稿承認/却下通知**: シンプルテンプレート（削るかも）

---

### B. 事務局側（Weby-Profile サイト内）

#### 記事登録フォーム

- **入力項目**:
  - 記事 URL
  - 対象 h2 テキスト（手動コピペ）
  - 任意のメモ
- **保存時**: `section_id` 自動発行

#### コード生成・コピー

- `[weby_section id="xxx"]` または `<iframe src=...>` を即表示・コピー可能

#### 投稿承認フロー

- **専門家の投稿一覧**: コメント本文 + 投稿者
- **ステータス変更**: 承認／却下／差戻し？
- **承認後**: 直後に先方サイトでコメント公開反映（API から返る）

#### 削除機能（記事・コメント）

- 専門家の間違い登録や不適切投稿を消せる

#### キャッシュ制御

- 投稿承認時に対象 `section_id` のキャッシュを invalidate（即時反映）

---

### C. 専門家側（Weby-Profile サイト内）

#### ログイン

- 招待のみ（限定されたカテゴリーの専門家のみ）

#### 招待された記事一覧

- カテゴリ・タグなし、単純リスト

#### 投稿フォーム

- **入力制限**: 200–500 字入力（Library 使う）
- **注意事項**: チェックボックス（例：外部誘導禁止）

#### 投稿履歴

- 各記事ごとの「新規／承認待ち／承認済み／却下」ステータス表示

#### 編集なし

- 誤投稿は「削除 → 再投稿」で対応

---

### D. メディア側（先方）

#### 埋め込み表示

- コピペした `<script>` を貼るだけで有効化
- 実際の描画は `<iframe>` 内で完結（サンドボックス化）

#### 表示内容

- **承認済み**: トップ 1 コメント（本文のみ）
- **専門家情報**: 名前・肩書き (顔写真は MVP では非表示 or サンプル画像)
- **未承認時**: 空白（何も表示されない）

#### CSS 適用

- MVP ではインライン CSS（API レスポンスに含める）で最小実装
- 将来は共通 CSS を外部読み込みに切り出せる構造

#### フォールバック

- API エラーやタイムアウト時も記事本文に影響を与えず、iframe 内は空白で終了

---

### E. 効果計測

#### SEO の向上メイン

- 何件承認されたかの数の表示
- 承認された記事の見られた PV 数（セッション数）

#### ブランドに掲載される → 権威獲得

---

## アーキテクチャー（仮：要相談）

### インフラ

- **AWS API Gateway + Lambda**（Node/TypeScript）
- **DynamoDB**（experts, sections, comments, moderation, metrics の最小テーブル構成）
- **CloudFront + S3**で `embed.js` / `widget.html` / 管理 UI を配信
- **SES**でメール送信（招待・承認通知）

### 認証

- **Auth0 もしくは Cognito**（MVP は Magic Link/OTP で最小実装）
- **2 ロール**: `admin`（事務局）／`expert`（専門家）

### 埋め込み

- `<script>` が `<iframe>` を生成
- iframe → API `/sections/{id}/top-comment` を呼んでコメント取得
- HTML をインライン CSS 付きで描画（承認済み 1 件のみ）
- CloudFront キャッシュを利用、承認時に invalidate で即時更新

### セキュリティ

- iframe サンドボックス化（記事側と分離）
- API の CORS はホワイトリスト制御
- コメント未承認時は空白を返す（安全なフォールバック）

---

## 成功指標（KPI）

### 短期（MVP 期間）

- 専門家登録数: 10 名以上
- 承認コメント数: 50 件以上
- 埋め込みサイト数: 5 サイト以上

### 中期（3 ヶ月後）

- 承認コメント数: 200 件以上
- 埋め込みサイト数: 20 サイト以上
- 月間 PV 数: 10,000PV 以上

### 長期（6 ヶ月後）

- 承認コメント数: 500 件以上
- 埋め込みサイト数: 50 サイト以上
- 月間 PV 数: 50,000PV 以上
- SEO 効果の定量的測定

---

## リスクと対策

### 技術的リスク

- **iframe 制限**: 各メディアサイトの CSP ポリシーによる制限
  - 対策: サンドボックス化とフォールバック機能
- **パフォーマンス**: 埋め込みによるサイト速度低下
  - 対策: CloudFront キャッシュと非同期読み込み

### ビジネスリスク

- **専門家の参加率**: 招待制による参加者数の制限
  - 対策: 魅力的な露出機会の提供
- **メディアサイトの採用率**: 技術的な敷居の高さ
  - 対策: 簡単な埋め込み方法の提供

---

## 開発フェーズ

### Phase 1: MVP 基盤構築（2 週間）

- 認証システム構築
- 基本的な CRUD 機能
- 埋め込み機能の基本実装

### Phase 2: 承認フロー実装（2 週間）

- 事務局・専門家の管理画面
- 承認フロー実装
- メール通知機能

### Phase 3: 埋め込み最適化（1 週間）

- iframe 最適化
- キャッシュ制御
- パフォーマンス改善

### Phase 4: 効果計測・改善（継続）

- 分析機能実装
- ユーザーフィードバック収集
- 機能改善

---

Last updated: 2025-01-19
